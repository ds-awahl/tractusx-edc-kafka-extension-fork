# Kafka pull solution design

## TODO

- install instructions
- current state of POC
- Kafka SASL setup
- define ContentDataAddress Type and TransferProcess Transfer Type (or keep current naming)
- ensure that Kafka will not be proxied via dataplane
- Dataplane Signaling?
    - Maybe not in the first draft, might me a SHOULD/COULD in the future
    - https://eclipse-edc.github.io/documentation/for-contributors/data-plane/data-plane-signaling/
    - https://github.com/eclipse-edc/Connector/tree/e3e6d5aab88f42d0d92e097276febee2aacfeff9/docs/developer/data-plane-signaling
- OAuth Token refresh
    - https://github.com/eclipse-tractusx/tractusx-edc/blob/main/docs/development/dataplane-signaling/tx-signaling.extensions.md
- Policy Monitor
    - https://eclipse-edc.github.io/documentation/for-contributors/control-plane/policy-monitor/
- Dataplane IAM Model for Token creation.
    - Can this be connected with Kafka?
- Deployment Topology.
    - How are the components deployed?
    - Which services are exposed?
- Data flow: Which system consumes/produces data when, where, and how
- Extensibility topics. Does it make sense to leave extensions for other message queue systems open/keep them in mind?

## Requirements

| ID      | Requirement                                                                                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Deliverables                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------|----------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 7.8.1.1 | Coordination with BMW and Cofinity-X for Clarification of Infinit Provider Push and Kafka Solution | For further optimization and implementation of the **BMW Infinit Provider Push** solution as well as the **Cofinity-X Kafka solution**, targeted coordination meetings should be held with the relevant stakeholders from BMW and Cofinity-X. The goal is to gain a detailed understanding of both solutions, clarify technical challenges, and define a consolidated approach for integration.                                                                                                                                                                                                                                                                                                                    | Meetings with the responsible parties from **BMW (Infinit Provider Push)** and **Cofinity-X (Kafka solution)** have been successfully held.  <br/> Clarification and documentation of the respective **technical concepts, architectures, and interfaces**.                                                                                                                                                                                                                                                                                                                                                                   |
| 7.8.1.2 | Migration of the Closed Source Repository to Tractus-X                                             | The current PoC implementation is closed source. It needs to be migrated to a Tractus-X repository.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | PoC is available in Tractus-X [tractusx-edc-kafka-extension](https://github.com/eclipse-tractusx/tractusx-edc-kafka-extension) <br/> Open Source Governance has been carried out <br/> Repository quality is appropriate.                                                                                                                                                                                                                                                                                                                                                                                                     |
| 7.8.1.3 | Analysis and Evaluation of the PoC                                                                 | For the extension of the DataPlane of the Tractus-X EDC, a Proof of Concept (PoC) should be developed that enables support for a streaming-capable protocol (Apache Kafka). The goal is to facilitate real-time data exchange at the data plane between data providers and consumers, and to make participation in the Catena-X data space more efficient and accessible.                                                                                                                                                                                                                                                                                                                                          | Analysis and evaluation of the PoC to identify optimization potential <br/> Optimization potentials are documented in the repository [tractusx-edc-kafka-extension](https://github.com/eclipse-tractusx/tractusx-edc-kafka-extension).                                                                                                                                                                                                                                                                                                                                                                                        |
| 7.8.1.5 | Identification and Definition of Use Cases                                                         | The relevant use cases for the Kafka Streaming Data Plane Extension have been described. **Note: "Requirements - what use cases need these"**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | Identification and definition of the use cases for which the Kafka EDC Data Plane can be used. Which use cases from CATENA-X can benefit from it. (10 core use cases and their sub use cases) <br/> e.g.: <br/> Real-time shop floor control <br/> Real-time shop floor monitoring <br/> Support for notification use cases <br/> 3-5 use cases are identified and documented in the repository.                                                                                                                                                                                                                              |
| 7.8.2.1 | Open Source Quality Assurance                                                                      | Implementation of Open Source Governance to manage the repository in the Eclipse Foundation & Tractus-X. <br/> The open-source software must adhere to defined quality standards and best practices to ensure high code quality, security, maintainability, and compliance.                                                                                                                                                                                                                                                                                                                                                                                                                                        | The repository [tractusx-edc-kafka-extension](https://github.com/eclipse-tractusx/tractusx-edc-kafka-extension) must meet the requirements according to TRG 7 - Open Source Governance. <br/> TRG 7 - Open Source Governance is fulfilled.                                                                                                                                                                                                                                                                                                                                                                                    |
| 7.8.3.2 | Data Access for the Consumer                                                                       | Streaming-capable protocol                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | The **data provider (Provider)** must be able to continuously provide data via a **streaming-capable protocol**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 7.8.3.3 | Data Access for the Consumer                                                                       | Provision via Eclipse Dataspace Connector (EDC).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | The provided data must be made available through the **Eclipse Dataspace Connector (EDC)**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 7.8.3.4 | Data Access for the Consumer                                                                       | Provider makes asset available via a catalog.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | The **provider provides an asset in the catalog** and defines **usage conditions** (Contract Policy).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 7.8.3.5 | Data Access for the Consumer                                                                       | Data consumer (Consumer) via EDC.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | The **data consumer (Consumer)** must have the ability to connect to the **provider's EDC** and retrieve the data stream.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 7.8.3.6 | Data Access for the Consumer                                                                       | Persistent connections between consumer and provider                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | The protocol must support **persistent connections**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 7.8.3.7 | Data Access for the Consumer                                                                       | Initiation of the data transfer via an API                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | The **initiation of the data transfer is done via an API** (e.g. using Insomnia or Postman).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 7.8.3.8 | Support for the Streaming Protocol Kafka                                                           |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | The **data streaming transfer** must be carried out using the **Kafka** (Pub/Sub messaging for real-time data streams) **protocol**.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 7.8.4.1 | Showcase – Streaming-capable Data Consumption via EDC with Defined Use Cases                       |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | As part of a demo, it should be shown that a data consumer (Consumer) can consume data from a data provider (Provider) via a streaming-capable protocol using the Eclipse Dataspace Connector (EDC). <br/> The setup of the demo includes: <br/> Provision of a data provider and data consumer <br/> Data consumption using the streaming protocol (Kafka) <br/> Use of Insomnia to interact with the data consumer and data provider <br/> Two specific use cases will be demonstrated <br/> Demo is carried out based on test data.                                                                                        |
| 7.8.5.1 | Proof of Processing Semantic Models in accordance with CX-0127 Industry Core: Part Instance 2.0.0  | The solution must ensure full compatibility with existing Catena-X interfaces and data models. This includes technical and semantic interoperability so that data exchange can occur seamlessly within the Catena-X ecosystem. <br/> Additionally, it must be demonstrated that the semantic models according to CX-0127 Industry Core: Part Instance 2.0.0 can be correctly processed. This is achieved through the implementation, validation, and testing of the relevant data models, including SerialPart, Batch, JustInSequencePart, SingleLevelBomAsBuilt, and SingleLevelUsageAsBuilt. Verification is carried out based on defined test cases and scenarios to ensure compliance with Catena-X standards. | It must be ensured that the semantic models from the repository [eclipse-tractusx/sldt-semantic-models](https://github.com/eclipse-tractusx/sldt-semantic-models/) can be processed according to the requirements of CX-0127 Industry Core: Part Instance 2.0.0. This includes, in particular, support for the following aspect models: <br/> SerialPart <br/> Batch <br/> JustInSequencePart <br/> SingleLevelBomAsBuilt <br/> SingleLevelUsageAsBuilt <br/> Proof is provided through the development and execution of specific test cases and scenarios that validate the full integration and processing of these models. |
| 7.8.6.1 | Standard Compatibility                                                                             | The solution must ensure that interoperability and standard compliance according to Catena-X requirements are guaranteed. This pertains to both the technical integration with existing Catena-X components and adherence to the defined data, API, and security standards.                                                                                                                                                                                                                                                                                                                                                                                                                                        | The solution is developed by the team according to the requirements of the standard https://catenax-ev.github.io/docs/standards/CX-0018-DataspaceConnectivity. <br/> The dS team verifies the solution according to the standard https://catenax-ev.github.io/docs/standards/CX-0018-DataspaceConnectivity. <br/> The verification is documented in the repository.                                                                                                                                                                                                                                                           |

## Problem Statement

The Tractus-X EDC currently lacks a dedicated, real-time data streaming mechanism that enables continuous, event-driven communication between data providers and consumers. This Proof of Concept (POC) integrates Apache Kafka as a decentralized component on the provider side, operating behind the Eclipse Dataspace Connector (EDC) to evaluate a publish/subscribe-based streaming solution that facilitates real-time machine and production data exchange on the automotive shop floor, thereby evaluating the necessary protocol extensions, integration challenges, and risks before full-scale adoption.

## Example

Consider an automotive shop floor where production machines continuously generate data on operational status, performance metrics, and production counts. Each company retains control over its own data sink and connects it to the Tractus-X network via the Eclipse Dataspace Connector, preserving data sovereignty. Within this framework, a decentralized Kafka Broker and Kafka Provider at the provider’s site manage the real-time publication of data, published as EDC Offer, while on the consumer side, individual Kafka Consumers consume the Offer, subscribe to the data stream to trigger immediate alerts and enable dynamic adjustments in production processes, thereby optimizing efficiency and reducing downtime.

## Use Cases

| Use Case                                      | Description                                                                                                                                                                                                                                                                                                                                                          |
|-----------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Real-time Operational Monitoring and Analysis | This use case encompasses the continuous real-time monitoring of production data, quality metrics, environmental parameters, and supply chain information. It enables immediate analysis and response to operational events, fostering optimized process control, proactive decision-making, and enhanced transparency across manufacturing and logistics processes. |
| Predictive Maintenance and Data Integration   | This use case focuses on leveraging streaming data to identify maintenance needs early while integrating external data sources to support informed decision-making. It helps minimize downtime through predictive maintenance and improves adaptability by incorporating external factors such as weather conditions and market trends.                              |

## NOTICE

This work is licensed under the [CC-BY-4.0](https://creativecommons.org/licenses/by/4.0/legalcode).

* SPDX-License-Identifier: CC-BY-4.0
* SPDX-FileCopyrightText: 2024 Contributors to the Eclipse Foundation
* Source URL: <https://github.com/eclipse-tractusx/tractus-x-umbrella>
